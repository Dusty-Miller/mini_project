{% extends 'shop/base.html' %}
{% block content %}

<div style="max-width: 1000px; margin: 60px auto; padding: 32px;
            background:#fff; border-radius:16px;
            box-shadow:0 8px 24px rgba(0,0,0,.08);">

  <h2 style="text-align:center; margin-bottom:24px; font-size:28px; font-weight:700;">
    포스트 작성
  </h2>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ postform.non_field_errors }}

    <!-- 기본 필드들 -->
    {% for field in postform %}
      <div style="margin-bottom:16px;">
        <label for="{{ field.id_for_label }}" style="display:block;margin-bottom:8px;font-weight:600;">
          {{ field.label }}
        </label>
        {{ field }}
        {{ field.errors }}
      </div>
    {% endfor %}

    <!-- 이미지 업로드 -->
    <h4 style="margin-top:32px; font-weight:600;">이미지 업로드</h4>
    {{ image_formset.management_form }}
    <div style="display:flex; flex-wrap:wrap; gap:16px; margin-top:16px;">
      {% for form in image_formset %}
        <div style="display:flex; flex-direction:column; align-items:center;">
          {{ form.image }}
          {{ form.image.errors }}
          <label for="{{ form.image.id_for_label }}"
                 class="preview-box"
                 style="width:120px;height:120px;border:1px solid #ccc;border-radius:6px;
                        background:#f9f9f9;display:flex;align-items:center;justify-content:center;
                        color:#bbb;font-size:24px; cursor:pointer;">
            +
          </label>
        </div>
      {% endfor %}
    </div>

    <!-- 제출 버튼 -->
    <button type="submit"
            style="display:block; width:100%; padding:12px; font-size:16px; font-weight:600;
                   background:#212529; color:#fff; border:none; border-radius:8px; cursor:pointer;
                   margin-top:32px;"
            onmouseover="this.style.opacity='0.9'"
            onmouseout="this.style.opacity='1'">
      제출
    </button>
  </form>
</div>

<!-- 이미지 미리보기 스크립트 -->
<script>
(function(){
  const previews = document.querySelectorAll('.preview-box');
  previews.forEach(preview => {
    const inputId = preview.getAttribute('for');
    const input = document.getElementById(inputId);
    if (!input) return;

    preview.addEventListener('click', () => input.click());
    input.addEventListener('change', function () {
      const f = this.files && this.files[0];
      if (!f) {
        preview.style.background = '#f9f9f9';
        preview.style.backgroundImage = '';
        preview.textContent = '+';
        return;
      }
      const r = new FileReader();
      r.onload = e => {
        preview.style.backgroundImage = `url(${e.target.result})`;
        preview.style.backgroundSize = 'cover';
        preview.style.backgroundPosition = 'center';
        preview.textContent = '';
      };
      r.readAsDataURL(f);
    });
  });
})();
</script>

{% endblock %}
